{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Register - NobarPedia</title>
{% endblock meta %}

{% block content %}
<style>
.join-us {
    font-family: "Poppins", sans-serif;
    font-size: 40px;
    font-style: normal;
    font-weight: 600;
    line-height: normal;
}

.input-bar {
    border-radius: 8px;
    border: 1px solid var(--Neutral-700, #666);
    background: var(--Neutral-900, #333);
    color: white;
}

.btn-signin {
    border-radius: 8px;
    border: 1px solid #6ADE7F;
    background: #2CAC5C;
    color: white;
    padding: 8px 28px;
}
</style>

<div class="min-h-screen bg-[#1E1E1E] flex items-center justify-center p-8">
    <div class="flex w-full relative z-10">
        <!-- Section Kiri: Image -->
        <div class="w-1/2 flex flex-col justify-between items-center">
            <!-- Blurry Rectangle -->
            <div class="absolute bottom-10 left-0 w-full h-[300px] bg-[#0a463241]/50 blur-3xl -z-10"></div>
            <!-- Image dan Headline -->
            <img src="{% static 'image/register-frame.png' %}"
                class="max-w-[749px] w-full h-auto object-contain z-10"></img>
            <h1 class="text-center text-[58px] z-10"> Lorem Ipsum Dolor Sit </h1>
            <h2 class="text-center headline z-10"> Lorem ipsum dolor sit amet, consectetur adipisc </h1>
        </div>
        <!-- Section Kanan: Form Register -->
        <div class="bg-[#333] w-1/2 rounded-[12px] p-8 shadow-sm">
            <div class="text-center mb-8">
                <h4 class="join-us">Join Us</h4>
            </div>

            <!-- Form Errors Display -->
            {% if form.non_field_errors %}
            <div class="mb-6">
                {% for error in form.non_field_errors %}
                <div class="px-4 py-3 rounded text-sm border bg-red-50 border-red-200 text-red-700">
                    {{ error }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if form.errors %}
            <div class="mb-6">
                {% for field, errors in form.errors.items %}
                {% if field != '__all__' %}
                    {% for error in errors %}
                    <div class="px-4 py-3 rounded text-sm border bg-red-50 border-red-200 text-red-700 mb-2">
                        <strong>{{ field|title }}:</strong> {{ error }}
                    </div>
                    {% endfor %}
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <form method="POST" action="" class="space-y-7">
                {% csrf_token %}
                
                <div>
                    <label for="username" class="block body mb-4">Username</label>
                    <input 
                    id="username" 
                    name="username" 
                    type="text" 
                    required 
                    class="w-full px-4 py-3 input-bar focus:outline-none focus:border-green-500 transition duration-200" 
                    placeholder="Choose a username">
                </div>
            {% comment %} 

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input 
                    id="email" 
                    name="email" 
                    type="email" 
                    required 
                    class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:border-green-500 transition duration-200" 
                    placeholder="Enter your Email">
                </div>

                <div>
                    <label for="fullname" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input 
                        id="fullname" 
                        name="fullname" 
                        type="text" 
                        maxlength="100" 
                        required 
                        class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:border-green-500 transition duration-200" 
                        placeholder="Enter your full name">
                </div>

                <div>
                    <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                    <input 
                        id="bio" 
                        name="bio" 
                        type="text" 
                        class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:border-green-500 transition duration-200" 
                        placeholder="Tell something about yourself">
                </div>

                <div>
                    <label for="profile_picture" class="block text-sm font-medium text-gray-700 mb-2">Profile Picture</label>
                    <input 
                        id="profile_picture" 
                        name="profile_picture" 
                        type="file" 
                        accept="image/*" 
                        class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:border-green-500 transition duration-200">
                </div> {% endcomment %}

                <div>
                    <label for="password1" class="block body mb-4">Password</label>
                    <input 
                    id="password1" 
                    name="password1" 
                    type="password" 
                    required 
                    class="w-full px-4 py-3 input-bar focus:outline-none focus:border-green-500 transition duration-200" 
                    placeholder="Create a password">
                </div>

                <div>
                    <label for="password2" class="block body mb-4">Confirm Password</label>
                    <input 
                    id="password2" 
                    name="password2" 
                    type="password" 
                    required 
                    class="w-full px-4 py-3 input-bar focus:outline-none focus:border-green-500 transition duration-200" 
                    placeholder="Confirm your password">
                </div>

                <button 
                    type="submit" 
                    class="w-full btn-signin headline font-medium rounded hover:bg-green-700 transition duration-200">
                    Create Account
                </button>
            </form>

            <!-- Messages Display -->
            {% if messages %}
            <div class="mt-6">
                {% for message in messages %}
                <div 
                    class="
                    px-4 py-3 rounded text-sm border
                    {% if message.tags == 'success' %}
                        bg-green-50 border-green-200 text-green-700
                    {% elif message.tags == 'error' %}
                        bg-red-50 border-red-200 text-red-700
                    {% else %}
                        bg-gray-50 border-gray-200 text-gray-700
                    {% endif %}
                    ">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="mt-6 text-center flex flex-col gap-1">
                <p class="footnote">
                    Already have an account? <a href="{% url 'account:login' %}" class="text-green-600 hover:text-green-700">Sign In</a>
                </p>
                <p class="footnote">Or</p>
                <p class="footnote">
                    Continue as <a href="{% url 'homepage:show_homepage' %}" class="text-green-600 hover:text-green-700">Guest</a>
                </p> 
            </div>
        </div>
    </div>
</div>



<script>
document.querySelector("form").addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = new FormData(this);

  const response = await fetch("{% url 'account:register_ajax' %}", {
    method: "POST",
    headers: { "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value },
    body: formData,
  });


  const data = await response.json();

  const msgContainer = document.createElement("div");
  msgContainer.classList.add("mt-4");
  const errorElements = document.querySelectorAll('.error-elements');
  errorElements.forEach(el => el.remove());

  if (data.success) {
    // showToast("âœ… You're account has been registered!", "Please log in to access the website.", "updated");
    this.reset();

    console.log('anj')

    setTimeout(() => {
      window.location.href = "{% url 'account:login' %}";
    }, 500);
  } else {
    msgContainer.innerHTML = "";
    for (const [field, errors] of Object.entries(data.errors || {})) {
      errors.forEach(err => {
        msgContainer.innerHTML += `
          <div class="error-elements text-sm text-red-200">
            <strong>${field}:</strong> ${err}
          </div>`;
      });
    }
  }

  this.insertAdjacentElement("afterend", msgContainer);
});
</script>
{% endblock content %}